#Institutions
	#
	eoanbr_institutions_setup = {
	# SCOPE: COUNTRY
	# Used to initialize institutions on game start
		clear_array = eoanbr_institutions_innovative_array
		clear_array = eoanbr_institutions_humanitive_array
		if = {
			limit = { has_idea = institution_rationalism }
			add_to_array = {
				array = eoanbr_institutions_innovative_array
				value = token:institution_rationalism
			}
			set_variable = {
				var = progress@token:institution_rationalism
				value = 100
			}
			add_research_slot = 1
		}
		else = {
			add_ideas = institution_rationalism_none
			if = {
				limit = { has_tech = tech_infantry_pre_rifle_equipment_0 }
				add_to_variable = {
					var = progress@token:institution_rationalism
					value = 2
				}
			}
			if = {
				limit = { has_tech = tech_infantry_pre_rifle_equipment_1 }
				add_to_variable = {
					var = progress@token:institution_rationalism
					value = 2
				}
			}
			if = {
				limit = { has_tech = tech_uniform_equipment_0 }
				add_to_variable = {
					var = progress@token:institution_rationalism
					value = 3
				}
			}
			if = {
				limit = { has_tech = tech_cavalry_equipment_0 }
				add_to_variable = {
					var = progress@token:institution_rationalism
					value = 2
				}
			}
			if = {
				limit = { has_tech = tribal_riding }
				add_to_variable = {
					var = progress@token:institution_rationalism
					value = 3
				}
			}
			if = {
				limit = { has_tech = tech_naval_mtg_sails }
				add_to_variable = {
					var = progress@token:institution_rationalism
					value = 5
				}
			}
			if = {
				limit = { has_tech = tribal_steam_experiments }
				add_to_variable = {
					var = progress@token:institution_rationalism
					value = 3
				}
			}
			if = {
				limit = { has_tech = tribal_forging }
				add_to_variable = {
					var = progress@token:institution_rationalism
					value = 3
				}
			}
			if = {
				limit = { has_tech = tribal_chemistry }
				add_to_variable = {
					var = progress@token:institution_rationalism
					value = 2
				}
			}
			if = {
				limit = { has_tech = tribal_irrigation }
				add_to_variable = {
					var = progress@token:institution_rationalism
					value = 3
				}
			}
			if = {
				limit = { has_tech = tech_trade_guilds }
				add_to_variable = {
					var = progress@token:institution_rationalism
					value = 5
				}
			}
		}
		if = {
			limit = { has_idea = institution_industrialization }
			add_to_array = {
				array = eoanbr_institutions_innovative_array
				value = token:institution_industrialization
			}
			set_variable = {
				var = progress@token:institution_industrialization
				value = 100
			}
			add_research_slot = 1
		}
		else = {
			add_ideas = institution_industrialization_none
			if = {
				limit = { has_tech = tech_infantry_gunpowder }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 2
				}
			}
			if = {
				limit = { has_tech = tech_infantry_pre_rifle_equipment_2 }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 2
				}
			}
			if = {
				limit = { has_tech = tech_uniform_equipment_1 }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 1
				}
			}
			if = {
				limit = { has_tech = iron_railways }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 2
				}
			}
			if = {
				limit = { has_tech = tech_naval_mtg_simple_corvette_hull }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 2
				}
			}
			if = {
				limit = { has_tech = tech_naval_mtg_early_frigate }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 2
				}
			}
			if = {
				limit = { has_tech = steam_engine }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 3
				}
			}
			if = {
				limit = { has_tech = manufactories }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 3
				}
			}
			if = {
				limit = { has_tech = interchange_parts }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 2
				}
			}
			if = {
				limit = { has_tech = dry_puddling_process }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 1
				}
			}
			if = {
				limit = { has_tech = cast_iron_industrialization }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 2
				}
			}
			if = {
				limit = { has_tech = food_canning }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 1
				}
			}
			if = {
				limit = { has_tech = tribal_crop_rotation }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 1
				}
			}
			if = {
				limit = { has_tech = tech_humanities_mercantilism }
				add_to_variable = {
					var = progress@token:institution_industrialization
					value = 1
				}
			}
		}
		if = {
			limit = { has_idea = institution_mechanization }
			add_to_array = {
				array = eoanbr_institutions_innovative_array
				value = token:institution_mechanization
			}
			set_variable = {
				var = progress@token:institution_mechanization
				value = 100
			}
		}
		else = {
			add_ideas = institution_mechanization_none
		}
		if = {
			limit = { has_idea = institution_electrification }
			add_to_array = {
				array = eoanbr_institutions_innovative_array
				value = token:institution_electrification
			}
			set_variable = {
				var = progress@token:institution_electrification
				value = 100
			}
			add_research_slot = 1
		}
		else = {
			add_ideas = institution_electrification_none
		}
		if = {
			limit = { has_idea = institution_mass_transit }
			add_to_array = {
				array = eoanbr_institutions_innovative_array
				value = token:institution_mass_transit
			}
			set_variable = {
				var = progress@token:institution_mass_transit
				value = 100
			}
		}
		else = {
			add_ideas = institution_mass_transit_none
		}
		if = {
			limit = { has_idea = institution_telecommunications }
			add_to_array = {
				array = eoanbr_institutions_innovative_array
				value = token:institution_telecommunications
			}
			set_variable = {
				var = progress@token:institution_telecommunications
				value = 100
			}
			add_research_slot = 1
		}
		else = {
			add_ideas = institution_telecommunications_none
		}
		if = {
			limit = { has_idea = institution_mass_production }
			add_to_array = {
				array = eoanbr_institutions_innovative_array
				value = token:institution_mass_production
			}
			set_variable = {
				var = progress@token:institution_mass_production
				value = 100
			}
		}
		else = {
			add_ideas = institution_mass_production_none
		}
		if = {
			limit = { has_idea = institution_green_revolution }
			add_to_array = {
				array = eoanbr_institutions_innovative_array
				value = token:institution_green_revolution
			}
			set_variable = {
				var = progress@token:institution_green_revolution
				value = 100
			}
		}
		else = {
			add_ideas = institution_green_revolution_none
		}
		if = {
			limit = { has_idea = institution_computing }
			add_to_array = {
				array = eoanbr_institutions_innovative_array
				value = token:institution_computing
			}
			set_variable = {
				var = progress@token:institution_computing
				value = 100
			}
			add_research_slot = 1
		}
		else = {
			add_ideas = institution_computing_none
		}
		if = {
			limit = { has_idea = institution_internet }
			add_to_array = {
				array = eoanbr_institutions_innovative_array
				value = token:institution_internet
			}
			set_variable = {
				var = progress@token:institution_internet
				value = 100
			}
		}
		else = {
			add_ideas = institution_computing_none
		}
		if = {
			limit = { has_idea = institution_automation }
			add_to_array = {
				array = eoanbr_institutions_innovative_array
				value = token:institution_automation
			}
			set_variable = {
				var = progress@token:institution_automation
				value = 100
			}
		}
		else = {
			add_ideas = institution_automation_none
		}
		if = {
			limit = { has_idea = institution_settlement }
			add_to_array = {
				array = eoanbr_institutions_humanitive_array
				value = token:institution_settlement
			}
			set_variable = {
				var = progress@token:institution_settlement
				value = 100
			}
		}
		else = {
			add_ideas = institution_settlement_none
			if = {
				limit = { has_tech = tech_infantry_pre_rifle_equipment_0 }
				add_to_variable = {
					var = progress@token:institution_settlement
					value = 5
				}
			}
			if = {
				limit = { has_tech = tribal_riding }
				add_to_variable = {
					var = progress@token:institution_settlement
					value = 5
				}
			}
			if = {
				limit = { has_tech = tribal_salted_smoked_goods }
				add_to_variable = {
					var = progress@token:institution_settlement
					value = 5
				}
			}
			if = {
				limit = { has_tech = tribal_irrigation }
				add_to_variable = {
					var = progress@token:institution_settlement
					value = 10
				}
			}
			if = {
				limit = { has_tech = tribal_forging }
				add_to_variable = {
					var = progress@token:institution_settlement
					value = 5
				}
			}
			if = {
				limit = { has_tech = tribal_artisan }
				add_to_variable = {
					var = progress@token:institution_settlement
					value = 5
				}
			}
		}
		if = {
			limit = { has_idea = institution_centralization }
			add_to_array = {
				array = eoanbr_institutions_humanitive_array
				value = token:institution_centralization
			}
			set_variable = {
				var = progress@token:institution_centralization
				value = 100
			}
			add_research_slot = 1
		}
		else = {
			add_ideas = institution_centralization_none
			if = {
				limit = { has_tech = tech_infantry_gunpowder }
				add_to_variable = {
					var = progress@token:institution_centralization
					value = 2
				}
			}
			if = {
				limit = { has_tech = tech_infantry_pre_rifle_equipment_2 }
				add_to_variable = {
					var = progress@token:institution_centralization
					value = 1
				}
			}
			if = {
				limit = { has_tech = tech_infantry_swords }
				add_to_variable = {
					var = progress@token:institution_centralization
					value = 2
				}
			}
			if = {
				limit = { has_tech = tech_support }
				add_to_variable = {
					var = progress@token:institution_centralization
					value = 2
				}
			}
			if = {
				limit = { has_tech = tribal_roads }
				add_to_variable = {
					var = progress@token:institution_centralization
					value = 3
				}
			}
			if = {
				limit = { has_tech = polymer_chemistry }
				add_to_variable = {
					var = progress@token:institution_centralization
					value = 1
				}
			}
			if = {
				limit = { has_tech = food_preserving_icebox }
				add_to_variable = {
					var = progress@token:institution_centralization
					value = 3
				}
			}
			if = {
				limit = { has_tech = tech_humanities_mercantilism }
				add_to_variable = {
					var = progress@token:institution_centralization
					value = 3
				}
			}
			if = {
				limit = { has_tech = tech_double_entry_bookkeeping }
				add_to_variable = {
					var = progress@token:institution_centralization
					value = 10
				}
			}
			if = {
				limit = { has_tech = tech_humanities_industrial_society }
				add_to_variable = {
					var = progress@token:institution_centralization
					value = 3
				}
			}
		}
		if = {
			limit = { has_idea = institution_nationalism }
			add_to_array = {
				array = eoanbr_institutions_humanitive_array
				value = token:institution_nationalism
			}
			set_variable = {
				var = progress@token:institution_nationalism
				value = 100
			}
		}
		else = {
			add_ideas = institution_nationalism_none
		}
		if = {
			limit = { has_idea = institution_imperialism }
			add_to_array = {
				array = eoanbr_institutions_humanitive_array
				value = token:institution_imperialism
			}
			set_variable = {
				var = progress@token:institution_imperialism
				value = 100
			}
		}
		else = {
			add_ideas = institution_imperialism_none
		}
		if = {
			limit = { has_idea = institution_marketization }
			add_to_array = {
				array = eoanbr_institutions_humanitive_array
				value = token:institution_marketization
			}
			set_variable = {
				var = progress@token:institution_marketization
				value = 100
			}
		}
		else = {
			add_ideas = institution_marketization_none
		}
		if = {
			limit = { has_idea = institution_feminism }
			add_to_array = {
				array = eoanbr_institutions_humanitive_array
				value = token:institution_feminism
			}
			set_variable = {
				var = progress@token:institution_feminism
				value = 100
			}
		}
		else = {
			add_ideas = institution_feminism_none
		}
		if = {
			limit = { has_idea = institution_dogmatism }
			add_to_array = {
				array = eoanbr_institutions_humanitive_array
				value = token:institution_dogmatism
			}
			set_variable = {
				var = progress@token:institution_dogmatism
				value = 100
			}
		}
		else = {
			add_ideas = institution_dogmatism_none
		}
		if = {
			limit = { has_idea = institution_globalization }
			add_to_array = {
				array = eoanbr_institutions_humanitive_array
				value = token:institution_globalization
			}
			set_variable = {
				var = progress@token:institution_globalization
				value = 100
			}
		}
		else = {
			add_ideas = institution_globalization_none
		}
		if = {
			limit = { has_idea = institution_environmentalism }
			add_to_array = {
				array = eoanbr_institutions_humanitive_array
				value = token:institution_environmentalism
			}
			set_variable = {
				var = progress@token:institution_environmentalism
				value = 100
			}
		}
		else = {
			add_ideas = institution_environmentalism_none
		}
		if = {
			limit = { has_idea = institution_social_media }
			add_to_array = {
				array = eoanbr_institutions_humanitive_array
				value = token:institution_social_media
			}
			set_variable = {
				var = progress@token:institution_social_media
				value = 100
			}
		}
		else = {
			add_ideas = institution_social_media_none
		}
		if = {
			limit = { has_idea = institution_space_colonialism }
			add_to_array = {
				array = eoanbr_institutions_humanitive_array
				value = token:institution_space_colonialism
			}
			set_variable = {
				var = progress@token:institution_space_colonialism
				value = 100
			}
		}
		else = {
			add_ideas = institution_space_colonialism_none
		}
		clear_variable = num_of_institutions
		add_to_variable = {
			var = num_of_institutions
			value = eoanbr_institutions_innovative_array^num
		}
		add_to_variable = {
			var = num_of_institutions
			value = eoanbr_institutions_humanitive_array^num
		}
	}
	eoanbr_institutions_inherit = {
	#SCOPE: COUNTRY
	# Used to inherit institutions from PREV
		hidden_effect = {
			for_each_loop = {
				array = global.eoanbr_institutions_innovative_array
				if = {
					limit = {
						is_in_array = {
							array = PREV.eoanbr_institutions_innovative_array
							value = v
						}
					}
					add_ideas = var:v
					set_variable = {
						var = progress@var:v
						value = 100
					}
				}
				set_variable = {
					var = progress@var:v
					value = PREV.progress@var:v
				}
			}
			
			for_each_loop = {
				array = global.eoanbr_institutions_humanitive_array
				if = {
					limit = {
						is_in_array = {
							array = PREV.eoanbr_institutions_humanitive_array
							value = v
						}
					}
					add_ideas = var:v
					set_variable = {
						var = progress@var:v
						value = 100
					}
				}
				set_variable = {
					var = progress@var:v
					value = PREV.progress@var:v
				}
			}
			set_variable = { num_of_institutions = eoanbr_institutions_innovative_array^num }
			add_to_variable = { num_of_institutions = eoanbr_institutions_humanitive_array^num }
			eoanbr_institutions_setup = yes
		}
	}
	#Innovative Change
		eoanbr_institutions_innovative_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_innovative_change = yes
			if = {
				limit = { NOT = { has_idea = institution_rationalism } }
				eoanbr_institutions_rationalism_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_industrialization } }
				eoanbr_institutions_industrialization_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_mechanization } }
				eoanbr_institutions_mechanization_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_electrification } }
				eoanbr_institutions_electrification_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_mass_transit } }
				eoanbr_institutions_mass_transit_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_telecommunications } }
				eoanbr_institutions_telecommunications_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_mass_production } }
				eoanbr_institutions_mass_production_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_green_revolution } }
				eoanbr_institutions_green_revolution_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_computing } }
				eoanbr_institutions_computing_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_internet } }
				eoanbr_institutions_internet_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_automation } }
				eoanbr_institutions_automation_change = yes
			}
		}
		eoanbr_institutions_rationalism_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_rationalism_change = yes
			add_to_variable = {
				var = progress@token:institution_rationalism
				value = institution_progress_temp
				tooltip = eoanbr_institutions_rationalism_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_rationalism
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_rationalism = 100 }
					NOT = { has_idea = institution_rationalism }
				}
				add_ideas = institution_rationalism
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_industrialization_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_industrialization_change = yes
			add_to_variable = {
				var = progress@token:institution_industrialization
				value = institution_progress_temp
				tooltip = eoanbr_institutions_industrialization_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_industrialization
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_industrialization = 100 }
					NOT = { has_idea = institution_industrialization }
				}
				add_ideas = institution_industrialization
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_mechanization_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_mechanization_change = yes
			add_to_variable = {
				var = progress@token:institution_mechanization
				value = institution_progress_temp
				tooltip = eoanbr_institutions_mechanization_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_mechanization
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_mechanization = 100 }
					NOT = { has_idea = institution_mechanization }
				}
				add_ideas = institution_mechanization
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_electrification_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_electrification_change = yes
			add_to_variable = {
				var = progress@token:institution_electrification
				value = institution_progress_temp
				tooltip = eoanbr_institutions_electrification_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_electrification
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_electrification = 100 }
					NOT = { has_idea = institution_electrification }
				}
				add_ideas = institution_electrification
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_mass_transit_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_mass_transit_change = yes
			add_to_variable = {
				var = progress@token:institution_mass_transit
				value = institution_progress_temp
				tooltip = eoanbr_institutions_mass_transit_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_mass_transit
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_mass_transit = 100 }
					NOT = { has_idea = institution_mass_transit }
				}
				add_ideas = institution_mass_transit
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_telecommunications_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_telecommunications_change = yes
			add_to_variable = {
				var = progress@token:institution_telecommunications
				value = institution_progress_temp
				tooltip = eoanbr_institutions_telecommunications_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_telecommunications
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_telecommunications = 100 }
					NOT = { has_idea = institution_telecommunications }
				}
				add_ideas = institution_telecommunications
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_mass_production_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_mass_production_change = yes
			add_to_variable = {
				var = progress@token:institution_mass_production
				value = institution_progress_temp
				tooltip = eoanbr_institutions_mass_production_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_mass_production
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_mass_production = 100 }
					NOT = { has_idea = institution_mass_production }
				}
				add_ideas = institution_mass_production
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_green_revolution_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_green_revolution_change = yes
			add_to_variable = {
				var = progress@token:institution_green_revolution
				value = institution_progress_temp
				tooltip = eoanbr_institutions_green_revolution_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_green_revolution
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_green_revolution = 100 }
					NOT = { has_idea = institution_green_revolution }
				}
				add_ideas = institution_green_revolution
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_computing_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_computing_change = yes
			add_to_variable = {
				var = progress@token:institution_computing
				value = institution_progress_temp
				tooltip = eoanbr_institutions_computing_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_computing
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_green_revolution = 100 }
					NOT = { has_idea = institution_computing }
				}
				add_ideas = institution_computing
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_internet_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_internet_change = yes
			add_to_variable = {
				var = progress@token:institution_internet
				value = institution_progress_temp
				tooltip = eoanbr_institutions_internet_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_internet
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_internet = 100 }
					NOT = { has_idea = institution_internet }
				}
				add_ideas = institution_internet
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_automation_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_automation_change = yes
			add_to_variable = {
				var = progress@token:institution_automation
				value = institution_progress_temp
				tooltip = eoanbr_institutions_automation_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_automation
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_automation = 100 }
					NOT = { has_idea = institution_automation }
				}
				add_ideas = institution_automation
			}
			clear_variable = institution_progress_temp
		}
	#
	#Humaitive Change
		eoanbr_institutions_humanitive_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_humanitive_change = yes
			if = {
				limit = { NOT = { has_idea = institution_settlement } }
				eoanbr_institutions_settlement_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_centralization } }
				eoanbr_institutions_centralization_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_nationalism } }
				eoanbr_institutions_nationalism_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_imperialism } }
				eoanbr_institutions_imperialism_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_marketization } }
				eoanbr_institutions_marketization_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_feminism } }
				eoanbr_institutions_feminism_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_dogmatism } }
				eoanbr_institutions_dogmatism_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_globalization } }
				eoanbr_institutions_globalization_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_environmentalism } }
				eoanbr_institutions_environmentalism_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_social_media } }
				eoanbr_institutions_social_media_change = yes
			}
			else_if = {
				limit = { NOT = { has_idea = institution_space_colonialism } }
				eoanbr_institutions_space_colonialism_change = yes
			}
		}
		eoanbr_institutions_settlement_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_settlement_change = yes
			add_to_variable = {
				var = progress@token:institution_settlement
				value = institution_progress_temp
				tooltip = eoanbr_institutions_settlement_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_settlement
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_settlement = 100 }
					NOT = { has_idea = institution_settlement }
				}
				add_ideas = institution_settlement
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_centralization_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_centralization_change = yes
			add_to_variable = {
				var = progress@token:institution_centralization
				value = institution_progress_temp
				tooltip = eoanbr_institutions_centralization_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_centralization
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_centralization = 100 }
					NOT = { has_idea = institution_centralization }
				}
				add_ideas = institution_centralization
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_nationalism_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_nationalism_change = yes
			add_to_variable = {
				var = progress@token:institution_nationalism
				value = institution_progress_temp
				tooltip = eoanbr_institutions_nationalism_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_nationalism
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_nationalism = 100 }
					NOT = { has_idea = institution_nationalism }
				}
				add_ideas = institution_nationalism
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_imperialism_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_imperialism_change = yes
			add_to_variable = {
				var = progress@token:institution_imperialism
				value = institution_progress_temp
				tooltip = eoanbr_institutions_imperialism_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_imperialism
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_imperialism = 100 }
					NOT = { has_idea = institution_imperialism }
				}
				add_ideas = institution_imperialism
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_marketization_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_marketization_change = yes
			add_to_variable = {
				var = progress@token:institution_marketization
				value = institution_progress_temp
				tooltip = eoanbr_institutions_marketization_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_marketization
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_marketization = 100 }
					NOT = { has_idea = institution_marketization }
				}
				add_ideas = institution_marketization
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_feminism_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_feminism_change = yes
			add_to_variable = {
				var = progress@token:institution_feminism
				value = institution_progress_temp
				tooltip = eoanbr_institutions_feminism_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_feminism
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_feminism = 100 }
					NOT = { has_idea = institution_feminism }
				}
				add_ideas = institution_feminism
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_dogmatism_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_dogmatism_change = yes
			add_to_variable = {
				var = progress@token:institution_dogmatism
				value = institution_progress_temp
				tooltip = eoanbr_institutions_dogmatism_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_dogmatism
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_dogmatism = 100 }
					NOT = { has_idea = institution_dogmatism }
				}
				add_ideas = institution_dogmatism
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_globalization_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_globalization_change = yes
			add_to_variable = {
				var = progress@token:institution_globalization
				value = institution_progress_temp
				tooltip = eoanbr_institutions_globalization_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_globalization
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_globalization = 100 }
					NOT = { has_idea = institution_globalization }
				}
				add_ideas = institution_globalization
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_environmentalism_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_environmentalism_change = yes
			add_to_variable = {
				var = progress@token:institution_environmentalism
				value = institution_progress_temp
				tooltip = eoanbr_institutions_environmentalism_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_environmentalism
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_environmentalism = 100 }
					NOT = { has_idea = institution_environmentalism }
				}
				add_ideas = institution_environmentalism
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_social_media_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_social_media_change = yes
			add_to_variable = {
				var = progress@token:institution_social_media
				value = institution_progress_temp
				tooltip = eoanbr_institutions_social_media_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_social_media
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_social_media = 100 }
					NOT = { has_idea = institution_social_media }
				}
				add_ideas = institution_social_media
			}
			clear_variable = institution_progress_temp
		}
		eoanbr_institutions_space_colonialism_change = {
			# SCOPE: COUNTRY
			# <value>: -100 to 100 (Integer Recommended)
			# set_temp_variable = { institution_progress_temp = <value> }
			# eoanbr_institutions_space_colonialism_change = yes
			add_to_variable = {
				var = progress@token:institution_space_colonialism
				value = institution_progress_temp
				tooltip = eoanbr_institutions_space_colonialism_change_tt
			}
			clamp_variable = {
				var = progress@token:institution_space_colonialism
				min = 0
				max = 100
			}
			if = {
				limit = {
					check_variable = { progress@token:institution_space_colonialism = 100 }
					NOT = { has_idea = institution_space_colonialism }
				}
				add_ideas = institution_space_colonialism
			}
			clear_variable = institution_progress_temp
		}
	#
#
#Demographics
	eoanbr_pops_country_promote_culture = {
		# type_temp : culture to be promoted
		if = {
			limit = {
				check_variable = { type_temp > 0 }
				NOT = {
					OR = {
						is_in_array = { pops_primary_culture_array = type_temp }
						is_in_array = { pops_promoted_culture_array = type_temp }
					}
				}
			}
			custom_effect_tooltip = eoanbr_pops_country_promote_culture_tt

			if = {
				limit = { is_in_array = { pops_marginalized_culture_array = type_temp } }
				remove_from_array = {
					array = pops_marginalized_culture_array
					value = type_temp
				}
			}
			else = {
				add_to_array = {
					array = pops_promoted_culture_array
					value = type_temp
				}
			}
		}
	}
	eoanbr_pops_country_demote_culture = {
		# type_temp : culture to be promoted
		if = {
			limit = {
				check_variable = { type_temp > 0 }
				NOT = {
					OR = {
						is_in_array = { pops_primary_culture_array = type_temp }
						is_in_array = { pops_marginalized_culture_array = type_temp }
					}
				}
			}
			custom_effect_tooltip = eoanbr_pops_country_demote_culture_tt

			if = {
				limit = { is_in_array = { pops_promoted_culture_array = type_temp } }
				remove_from_array = {
					array = pops_promoted_culture_array
					value = type_temp
				}
			}
			else = {
				add_to_array = {
					array = pops_marginalized_culture_array
					value = type_temp
				}
			}
		}
	}
	eoanbr_pops_country_promote_religion = {
		# type_temp : demote to be promoted
		if = {
			limit = {
				check_variable = { type_temp > 0 }
				NOT = {
					OR = {
						is_in_array = { pops_primary_religion_array = type_temp }
						is_in_array = { pops_promoted_religion_array = type_temp }
					}
				}
			}
			custom_effect_tooltip = eoanbr_pops_country_promote_religion_tt

			if = {
				limit = { is_in_array = { pops_marginalized_religion_array = type_temp } }
				remove_from_array = {
					array = pops_marginalized_religion_array
					value = type_temp
				}
			}
			else = {
				add_to_array = {
					array = pops_promoted_religion_array
					value = type_temp
				}
			}
		}
	}
	eoanbr_pops_country_demote_religion = {
		# type_temp : religion to be demoted
		if = {
			limit = {
				check_variable = { type_temp > 0 }
				NOT = {
					OR = {
						is_in_array = { pops_primary_religion_array = type_temp }
						is_in_array = { pops_marginalized_religion_array = type_temp }
					}
				}
			}
			custom_effect_tooltip = eoanbr_pops_country_demote_religion_tt

			if = {
				limit = { is_in_array = { pops_promoted_religion_array = type_temp } }
				remove_from_array = {
					array = pops_promoted_religion_array
					value = type_temp
				}
			}
			else = {
				add_to_array = {
					array = pops_marginalized_religion_array
					value = type_temp
				}
			}
		}
	}
	eoanbr_pops_country_setup = {
		every_owned_state = {
			for_each_loop = {
				array = pops_culture_array
				value = cc

				set_variable = {
					var = population_k@var:cc
					value = percentage@var:cc
				}
				multiply_variable = {
					var = population_k@var:cc
					value = state_population_k
				}
			}
			for_each_loop = {
				array = pops_religion_array
				value = rr

				set_variable = {
					var = population_k@var:rr
					value = percentage@var:rr
				}
				multiply_variable = {
					var = population_k@var:rr
					value = state_population_k
				}
			}
		}
	}
	eoanbr_pops_country_update = {
		# clear_variable = pops
		clear_variable = core_population_k

		clear_variable = population_k@token:culture_type_primary
		clear_variable = core_population_k@token:culture_type_primary
		clear_variable = population_k@token:culture_type_promoted
		clear_variable = core_population_k@token:culture_type_promoted
		clear_variable = population_k@token:culture_type_normal
		clear_variable = core_population_k@token:culture_type_normal
		clear_variable = population_k@token:culture_type_marginalized
		clear_variable = core_population_k@token:culture_type_marginalized

		clear_variable = population_k@token:religion_type_primary
		clear_variable = core_population_k@token:religion_type_primary
		clear_variable = population_k@token:religion_type_promoted
		clear_variable = core_population_k@token:religion_type_promoted
		clear_variable = population_k@token:religion_type_normal
		clear_variable = core_population_k@token:religion_type_normal
		clear_variable = population_k@token:religion_type_marginalized
		clear_variable = core_population_k@token:religion_type_marginalized

		for_each_loop = {
			array = pops_culture_array
			value = cc

			clear_variable = population_k@var:cc
			clear_variable = core_population_k@var:cc
			clear_variable = percentage@var:cc
			clear_variable = core_percentage@var:cc
		}
		clear_array = pops_culture_array

		for_each_loop = {
			array = pops_religion_array
			value = rr

			clear_variable = population_k@var:rr
			clear_variable = core_population_k@var:rr
			clear_variable = percentage@var:rr
			clear_variable = core_percentage@var:rr
		}
		clear_array = pops_religion_array


		every_owned_state = {
			# eoanbr_pops_state_normalize_culture = yes
			# eoanbr_pops_state_normalize_religion = yes
			if = {
				limit = { is_core_of = PREV }
				#Culture
					for_each_loop = {
						array = pops_culture_array
						value = cc

						if = {
							limit = {
								NOT = {
									is_in_array = {
										array = PREV.pops_culture_array
										value = cc
									}
								}
							}
							add_to_array = {
								array = PREV.pops_culture_array
								value = cc
							}
						}
						add_to_variable = {
							var = PREV.population_k@var:cc
							value = population_k@var:cc
						}
						add_to_variable = {
							var = PREV.population_k@var:cc
							value = core_population_k@var:cc
						}
					}
					add_to_variable = {
						var = PREV.population_k@token:culture_type_primary
						value = population_k@token:culture_type_primary
					}
					add_to_variable = {
						var = PREV.core_population_k@token:culture_type_primary
						value = core_population_k@token:culture_type_primary
					}
					add_to_variable = {
						var = PREV.population_k@token:culture_type_promoted
						value = population_k@token:culture_type_promoted
					}
					add_to_variable = {
						var = PREV.core_population_k@token:culture_type_promoted
						value = core_population_k@token:culture_type_promoted
					}
					add_to_variable = {
						var = PREV.population_k@token:culture_type_normal
						value = population_k@token:culture_type_normal
					}
					add_to_variable = {
						var = PREV.core_population_k@token:culture_type_normal
						value = core_population_k@token:culture_type_normal
					}
					add_to_variable = {
						var = PREV.population_k@token:culture_type_marginalized
						value = population_k@token:culture_type_marginalized
					}
					add_to_variable = {
						var = PREV.core_population_k@token:culture_type_marginalized
						value = core_population_k@token:culture_type_marginalized
					}
				#
				#Religion
					for_each_loop = {
						array = pops_religion_array
						value = rr

						if = {
							limit = {
								NOT = {
									is_in_array = {
										array = PREV.pops_religion_array
										value = rr
									}
								}
							}
							add_to_array = {
								array = PREV.pops_religion_array
								value = rr
							}
						}
						add_to_variable = {
							var = PREV.population_k@var:rr
							value = population_k@var:rr
						}
						add_to_variable = {
							var = PREV.population_k@var:rr
							value = core_population_k@var:rr
						}
					}
					add_to_variable = {
						var = PREV.population_k@token:religion_type_primary
						value = population_k@token:religion_type_primary
					}
					add_to_variable = {
						var = PREV.core_population_k@token:religion_type_primary
						value = core_population_k@token:religion_type_primary
					}
					add_to_variable = {
						var = PREV.population_k@token:religion_type_promoted
						value = population_k@token:religion_type_promoted
					}
					add_to_variable = {
						var = PREV.core_population_k@token:religion_type_promoted
						value = core_population_k@token:religion_type_promoted
					}
					add_to_variable = {
						var = PREV.population_k@token:religion_type_normal
						value = population_k@token:religion_type_normal
					}
					add_to_variable = {
						var = PREV.core_population_k@token:religion_type_normal
						value = core_population_k@token:religion_type_normal
					}
					add_to_variable = {
						var = PREV.population_k@token:religion_type_marginalized
						value = population_k@token:religion_type_marginalized
					}
					add_to_variable = {
						var = PREV.core_population_k@token:religion_type_marginalized
						value = core_population_k@token:religion_type_marginalized
					}
				#
				add_to_variable = {
					var = PREV.core_population_k
					value = state_population_k
				}
			}
			else = {
				#Culture
					for_each_loop = {
						array = pops_culture_array
						value = cc

						if = {
							limit = {
								NOT = {
									is_in_array = {
										array = PREV.pops_culture_array
										value = cc
									}
								}
							}
							add_to_array = {
								array = PREV.pops_culture_array
								value = cc
							}
						}
						add_to_variable = {
							var = PREV.population_k@var:cc
							value = population_k@var:cc
						}
					}
					add_to_variable = {
						var = PREV.population_k@token:culture_type_primary
						value = population_k@token:culture_type_primary
					}
					add_to_variable = {
						var = PREV.population_k@token:culture_type_promoted
						value = population_k@token:culture_type_promoted
					}
					add_to_variable = {
						var = PREV.population_k@token:culture_type_normal
						value = population_k@token:culture_type_normal
					}
					add_to_variable = {
						var = PREV.population_k@token:culture_type_marginalized
						value = population_k@token:culture_type_marginalized
					}
				#
				#Religion
					for_each_loop = {
						array = pops_religion_array
						value = rr

						if = {
							limit = {
								NOT = {
									is_in_array = {
										array = PREV.pops_religion_array
										value = rr
									}
								}
							}
							add_to_array = {
								array = PREV.pops_religion_array
								value = rr
							}
						}
						add_to_variable = {
							var = PREV.population_k@var:rr
							value = population_k@var:rr
						}
					}
					add_to_variable = {
						var = PREV.population_k@token:religion_type_primary
						value = population_k@token:religion_type_primary
					}
					add_to_variable = {
						var = PREV.population_k@token:religion_type_promoted
						value = population_k@token:religion_type_promoted
					}
					add_to_variable = {
						var = PREV.population_k@token:religion_type_normal
						value = population_k@token:religion_type_normal
					}
					add_to_variable = {
						var = PREV.population_k@token:religion_type_marginalized
						value = population_k@token:religion_type_marginalized
					}
				#
			}
		}

		# Count
			set_variable = {
				var = percentage@token:culture_type_primary
				value = population_k@token:culture_type_primary
			}
			divide_variable = {
				var = percentage@token:culture_type_primary
				value = pops
			}
			set_variable = {
				var = core_percentage@token:culture_type_primary
				value = core_population_k@token:culture_type_primary
			}
			divide_variable = {
				var = core_percentage@token:culture_type_primary
				value = core_population_k
			}
			set_variable = {
				var = percentage@token:culture_type_promoted
				value = population_k@token:culture_type_promoted
			}
			divide_variable = {
				var = percentage@token:culture_type_promoted
				value = pops
			}
			set_variable = {
				var = core_percentage@token:culture_type_promoted
				value = core_population_k@token:culture_type_promoted
			}
			divide_variable = {
				var = core_percentage@token:culture_type_promoted
				value = core_population_k
			}
			set_variable = {
				var = percentage@token:culture_type_normal
				value = population_k@token:culture_type_normal
			}
			divide_variable = {
				var = percentage@token:culture_type_normal
				value = pops
			}
			set_variable = {
				var = core_percentage@token:culture_type_normal
				value = core_population_k@token:culture_type_normal
			}
			divide_variable = {
				var = core_percentage@token:culture_type_normal
				value = core_population_k
			}
			set_variable = {
				var = percentage@token:culture_type_marginalized
				value = population_k@token:culture_type_marginalized
			}
			divide_variable = {
				var = percentage@token:culture_type_marginalized
				value = pops
			}
			set_variable = {
				var = core_percentage@token:culture_type_marginalized
				value = core_population_k@token:culture_type_marginalized
			}
			divide_variable = {
				var = core_percentage@token:culture_type_marginalized
				value = core_population_k
			}
			set_variable = {
				var = percentage@token:religion_type_primary
				value = population_k@token:religion_type_primary
			}
			divide_variable = {
				var = percentage@token:religion_type_primary
				value = pops
			}
			set_variable = {
				var = core_percentage@token:religion_type_primary
				value = core_population_k@token:religion_type_primary
			}
			divide_variable = {
				var = core_percentage@token:religion_type_primary
				value = core_population_k
			}
			set_variable = {
				var = percentage@token:religion_type_promoted
				value = population_k@token:religion_type_promoted
			}
			divide_variable = {
				var = percentage@token:religion_type_promoted
				value = pops
			}
			set_variable = {
				var = core_percentage@token:religion_type_promoted
				value = core_population_k@token:religion_type_promoted
			}
			divide_variable = {
				var = core_percentage@token:religion_type_promoted
				value = core_population_k
			}
			set_variable = {
				var = percentage@token:religion_type_normal
				value = population_k@token:religion_type_normal
			}
			divide_variable = {
				var = percentage@token:religion_type_normal
				value = pops
			}
			set_variable = {
				var = core_percentage@token:religion_type_normal
				value = core_population_k@token:religion_type_normal
			}
			divide_variable = {
				var = core_percentage@token:religion_type_normal
				value = core_population_k
			}
			set_variable = {
				var = percentage@token:religion_type_marginalized
				value = population_k@token:religion_type_marginalized
			}
			divide_variable = {
				var = percentage@token:religion_type_marginalized
				value = pops
			}
			set_variable = {
				var = core_percentage@token:religion_type_marginalized
				value = core_population_k@token:religion_type_marginalized
			}
			divide_variable = {
				var = core_percentage@token:religion_type_marginalized
				value = core_population_k
			}
		#
		eoanbr_pops_country_sort_culture = yes
		eoanbr_pops_country_sort_religion = yes
	}

	eoanbr_pops_country_sort_culture = {
		clear_temp_array = pops_culture_array_temp

		add_to_temp_array = {
			array = pops_culture_array_temp
			value = pops_culture_array^0
		}

		for_loop_effect = {
			start = 1
			end = pops_culture_array^num
			break = bb
			value = ii

			set_temp_variable = {
				var = cc
				value = pops_culture_array^ii
			}

			for_each_loop = {
				array = pops_culture_array_temp
				value = ccc
				index = iii
				break = bbb

				if = {
					limit = {
						check_variable = {
							var = population_k@var:ccc
							value = population_k@var:cc
							compare = less_than_or_equals
						}
					}
					add_to_temp_array = {
						array = pops_culture_array_temp
						value = cc
						index = iii
					}
					set_temp_variable = { bbb = 1 }
				}
			}
			if = {
				limit = {
					check_variable = { bbb = 0	}
				}
				add_to_temp_array = {
					array = pops_culture_array_temp
					value = cc
				}
			}
		}

		clear_array = pops_culture_array
		for_each_loop = {
			array = pops_culture_array_temp
			value = cc

			add_to_array = {
				array = pops_culture_array
				value = cc
			}
			set_variable = {
				var = percentage@var:cc
				value = population_k@var:cc
			}
			divide_variable = {
				var = percentage@var:cc
				value = max_manpower_k
			}
		}
		clear_temp_array = pops_culture_array_temp
	}
	eoanbr_pops_country_sort_religion = {
		clear_temp_array = pops_religion_array_temp

		add_to_temp_array = {
			array = pops_religion_array_temp
			value = pops_religion_array^0
		}

		for_loop_effect = {
			start = 1
			end = pops_religion_array^num
			break = bb
			value = ii

			set_temp_variable = {
				var = rr
				value = pops_religion_array^ii
			}

			for_each_loop = {
				array = pops_religion_array_temp
				value = rrr
				index = iii
				break = bbb

				if = {
					limit = {
						check_variable = {
							var = population_k@var:rrr
							value = population_k@var:rr
							compare = less_than_or_equals
						}
					}
					add_to_temp_array = {
						array = pops_religion_array_temp
						value = rr
						index = iii
					}
					set_temp_variable = { bbb = 1 }
				}
			}
			else_if = {
				limit = {
					check_variable = { bbb = 0	}
				}
				add_to_temp_array = {
					array = pops_religion_array_temp
					value = rr
				}
			}
		}

		clear_array = pops_religion_array
		for_each_loop = {
			array = pops_religion_array_temp
			value = rr

			add_to_array = {
				array = pops_religion_array
				value = rr
			}
			set_variable = {
				var = percentage@var:rr
				value = population_k@var:rr
			}
			divide_variable = {
				var = percentage@var:rr
				value = max_manpower_k
			}
		}
		clear_temp_array = pops_religion_array_temp
	}
#
#Other
	eoanbr_demographic_state_update = {
		for_each_loop = {
			array = pops_culture_array
			value = culture_temp

			set_variable = { population_k@var:culture_temp = percentage@var:culture_temp }
			multiply_variable = { population_k@var:culture_temp = state_population_k }
		}
		for_each_loop = {
			array = pops_religion_array
			value = culture_temp

			set_variable = { population_k@var:culture_temp = percentage@var:culture_temp }
			multiply_variable = { population_k@var:culture_temp = state_population_k }
		}
	}
	eoanbr_demographic_bookmark_adjustment = {
		every_owned_state = {
			set_temp_variable = {
				var = population_temp
				value = state_population
			}
			multiply_temp_variable = {
				var = population_temp
				value = OWNER.population_bookmark_adjustment
			}
			add_manpower = population_temp
		}
	}
#